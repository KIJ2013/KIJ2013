var KIJ2013=(function(p,j,B){var D="core",q="preferences",s="settings",A="settings.json",i,h,a,m,E={},d=j({}),z=function(){a=j("#popup");i=j("#loading");var G;d.bind("contentready",function(){console.log("contentready");y();j("#action_bar").show();w(G);setTimeout(function(){p.scrollTo(0,1)},0)});d.bind("databaseready",function(){console.log("databaseready");var I=j("#action_bar select"),H,J=false;I.empty();for(module in E){H=E[module];if(!G){G=module;if(H.contentready){H.contentready(function(){d.trigger("contentready")})}else{J=true}}j("<option>").text(KIJ2013.Util.ucfirst(module)).appendTo(I);(typeof H.init=="function")&&H.init()}I.change(function(){w(I.val())});if(J){d.trigger("contentready")}});m=B({name:D},function(){var H=false,I=false,J=false;this.get(q,function(K){if(K){v=K}if(I&&!J){d.trigger("databaseready");J=true}H=true});d.bind("settingsload",function(){console.log("settingsload");if(H&&!J){d.trigger("databaseready");J=true}I=true});this.get(s,function(K){if(K){C=K;d.trigger("settingsload")}F()})})},F=function(){var G=C.settingsURL.push?C.settingsURL.slice():[C.settingsURL];G.push(A);KIJ2013.Util.loadFirst(G,function(H){H.key=s;C=H;if(m){m.save(C)}else{console.log("Error: Store not available to save settings")}d.trigger("settingsload")})},b=function(){return{key:s,settingsURL:A}},C=b(),k=function(){return{key:q}},v=k(),n=function(G,H){return C[G]||H||null},x=function(G){return(C.modules&&C.modules[G])||{}},o=function(G,H){return v[G]||H||null},u=function(G,H){if(G=="key"){return}v[G]=H;m.save(v)},g=function(G){v=k();m.save(v,G)},t=function(G){C=b();m.save(C,G);F();for(module in E){if(E[module].clearCache){E[module].clearCache()}}},w=function(H){var I=j("section:visible"),G;j.each(I,function(J,K){G=KIJ2013.Util.ucfirst(j(K).attr("id"));if(E[G]&&typeof E[G].hide=="function"){E[G].hide()}});I.hide();j("#"+H.toLowerCase()).show();r(H);if(E[H]&&typeof E[H].show=="function"){E[H].show()}c()},y=function(G){if(typeof G=="function"){j("#up-button").removeAttr("href").unbind().click(function(){G();return false});j("#up-icon").css({visibility:"visible"})}else{if(typeof G=="string"){j("#up-button").unbind().click(function(){w(G);return false});j("#up-icon").css("visibility","visible")}else{if(typeof G=="undefined"){j("#up-icon").css("visibility","hidden")}}}},r=function(H){var I=typeof H=="undefined"||H=="",G="KIJ2013";j("#action_bar h1").text(I?G:H)},f=function(){if(i.length==0){i=j("<div/>").attr("id","loading").text("Loading").append(j("<img/>").attr("src","img/ajax-loader.gif")).appendTo("#body")}h=j("section:visible").hide();i.show()},l=function(){if(i){i.hide()}if(h){h.show();h=null}},e=function(G){if(a.length==0){a=j("<div/>").attr("id","popup").appendTo("body")}a.text(G).show();setTimeout(function(){a.slideUp("normal")},5000)},c=function(){p.scrollTo(0,1)};return{clearCaches:t,clearPreferences:g,getModuleSettings:x,getPreference:o,getSetting:n,hideLoading:l,init:z,navigateTo:w,scrollTop:c,setActionBarUp:y,setPreference:u,setTitle:r,showError:e,showLoading:f,Modules:E}}(window,jQuery,Lawnchair));$(function(){KIJ2013.init()});(function(){var f=function(h,g){if(arguments.length<2){g=255}if(arguments.length<1){h=0}return"rgb("+((g-h)*Math.random()+h).toFixed()+","+((g-h)*Math.random()+h).toFixed()+","+((g-h)*Math.random()+h).toFixed()+")"},c=function(i,h,k,j){var g=function(l){return j?j(l[i]):l[i]};h=arguments.length==2?arguments[1]:arguments[2];k=arguments.length==2?"=":arguments[1];return function(m){var l=g(m);return k=="="?l==h:(k==">"?l>h:(k=="<"?l<h:true))}},b=function(i,g,j){var h=function(k){return j?j(k[i]):k[i]};g=typeof g=="undefined"||g;return function(m,l){var k=h(m),n=h(l);return(k<n?-1:(k>n?+1:0))*[-1,1][+!!g]}},e=function(){var k=[],n,m,g,l,h;for(l=0,m=arguments.length;l<m;l++){n=arguments[l];for(h=0,g=n.length;h<g;h++){if(k.indexOf(n[h])===-1){k.push(n[h])}}}return k},a=function(g){return g.slice(0,1).toUpperCase()+g.slice(1)},d=function(j,k,h){if(!j){return}var g=j.length,i=function(l){return $.ajax({url:j[l]+"?"+(Math.random()*10000).toFixed(),dataType:h||"json",success:k,error:function(){if(l<g-1){i(l+1)}}})};return i(0)};KIJ2013.Util={randomColor:f,filter:c,sort:b,merge:e,ucfirst:a,loadFirst:d}}());(function(n,d,q){var j="news",e,a=false,c=false,l=null,r={},b=d({}),o=function(){r=n.getModuleSettings("News");m();i()},m=function(){e=new q({name:j},function(){})},i=function(){if(!a){a=true;d.get(r.rssURL,function(w){var u=[],v,x;d(w).find("item").each(function(z,y){v={key:d(y).find("guid").text(),title:d(y).find("title").text(),date:(new Date(d(y).find("pubDate").text()))/1000,description:d(y).find("content\\:encoded, encoded").text()||d(y).find("description").text()};x=d(v.description).find("img");if(x.length){v.image=d(x[0]).attr("src")}u.push(v)});e.batch(u,function(){if(l=="list"){f()}b.trigger("contentready");c=true});a=false},"xml").error(function(w,u,v){n.showError("Error Fetching Items: "+u);a=false})}},g=function(v){var u=d(v.currentTarget);h(u.data("guid"))},f=function(){l="list";n.setActionBarUp();n.setTitle("News");n.scrollTop();e.all(function(u){if(u.length){u.sort(n.Util.sort("date",false));var v=d("<ul/>").attr("id","news-list").addClass("listview");d.each(u,function(x,z){var w,y,A;w=d("<li/>");y=d("<a/>").attr("id",z.key);A=d("<span/>").text(z.title);y.append(A);y.data("guid",z.key);y.click(g);if(x==0){w.css({width:"100%"});y.css({height:"140px"})}if(z.image){y.css({backgroundImage:"url("+z.image+")"})}y.css({backgroundColor:n.Util.randomColor(128)});w.append(y);v.append(w)});d("#news").empty().append(v);n.hideLoading();if(!c){b.trigger("contentready");c=true}}})},h=function(u){l="item";n.setActionBarUp(function(){f()});e.get(u,function(w){var v=d("<div/>").css({padding:"10px"});n.setTitle(w.title);d("<h1/>").text(w.title).appendTo(v);v.append(w.description);d("#news").empty().append(v);n.scrollTop()})},s=function(){f()},k=function(){l=null},t=function(){e.nuke()},p=function(u){b.bind("contentready",u)};n.Modules.News={init:o,show:s,hide:k,clearCache:t,contentready:p}}(KIJ2013,jQuery,Lawnchair));(function(m,e,i){var l="events",k,b=false,d={},q=function(){k=new i({name:l},function(){})},o=function(){e.get(d.jsonURL,function(t){var r=[],s;e(t).each(function(v,u){s={key:u.guid,title:u.title,date:u.date,category:u.category,remind:!!u.remind,description:u.description};k.get(u.guid,function(w){if(w){s.remind=w.remind}});r.push(s)});k.batch(r,function(){if(b){g()}})},"json").error(function(t,r,s){m.showError("Error Fetching Events: "+r)})},c=function(){n(e(this).data("guid"))},a=function(t){var r=t.data.guid,s="active btn-success",u=e(this).toggleClass(s).hasClass(s);k.get(r,function(v){v.remind=u;k.save(v)});return false},g=function(){m.setActionBarUp();m.setTitle("Events");var r=m.getPreference("subcamp");k.all(function(y){var w=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],x,t,z,A,u,v,B,C,s;if(y.length){y=y.filter(m.Util.filter("date",">",(new Date())/1000));if(r){y=m.Util.merge(y.filter(m.Util.filter("category",r)),y.filter(m.Util.filter("category","all")))}y.sort(m.Util.sort("date"));x=e("<ul/>").attr("id","event-list").addClass("listview");e.each(y,function(D,E){z=E.key;A=e("<li/>");t=e("<a/>").attr("id",z);u=new Date(E.date*1000);v=e("<p/>").addClass("date-text").text(u.getDate()+" "+w[u.getMonth()]);B=e("<p/>").addClass("title").text(E.title);C=e("<a/>").addClass("remind-btn btn").addClass(E.remind?"active btn-success":"").text("Remind").click({guid:z},a);s=e("<p/>").addClass("category").text(E.category);t.data("guid",z);t.click(c);t.append(v).append(B).append(C).append(s);A.append(t);x.append(A)});e("#events").empty().append(x);m.hideLoading()}else{m.showLoading()}})},n=function(r){m.setActionBarUp(g);m.scrollTop();k.get(r,function(u){if(u){var t=e("<div/>").css({padding:"10px"}),s=new Date(u.date*1000);m.setTitle(u.title);e("#events").empty();e("<h1/>").text(u.title).appendTo(t);e("<p/>").addClass("date-text").text(s.toLocaleString()).appendTo(t);e("<a/>").addClass("btn").addClass(u.remind?"active btn-success":"").text("Remind").click({guid:r},a).appendTo(t);e("<p/>").attr("id","remind-text").text(u.remind?"You will be reminded about this event.":"You will not be reminded about this event").appendTo(t);e("<p/>").addClass("category").text(u.category).appendTo(t);e("<p/>").text(u.description).appendTo(t);e("#events").append(t)}})},p=function(){d=m.getModuleSettings("Events");q();o()},j=function(){b=true;g()},f=function(){b=false},h=function(){k.nuke()};m.Modules.Events={init:p,show:j,hide:f,clearCache:h}}(KIJ2013,jQuery,Lawnchair));(function(n,e,l){var m,a,f,g,j=false,c={},p=function(){var q=c=n.getModuleSettings("Map");m=q.imageSize[0]/(q.imageBounds[2]-q.imageBounds[0]);a=q.imageSize[1]/(q.imageBounds[3]-q.imageBounds[1])},h=function(q){if(q<c.imageBounds[0]){throw"OutOfBounds"}if(q>c.imageBounds[2]){throw"OutOfBounds"}return(q-c.imageBounds[0])*m},b=function(q){if(q<c.imageBounds[1]){throw"OutOfBounds"}if(q>c.imageBounds[3]){throw"OutOfBounds"}return(q-c.imageBounds[1])*a},k=function(){var q=l.geolocation;if(!j){f=e("#map img");if(f.length==0){n.showLoading();f=e("<img />").attr("src",c.imageURL).appendTo("#map").load(function(){o(51.3015,0.584);n.hideLoading()})}g=e("#marker");j=true}else{o(51.3015,0.584)}if(q){q.getCurrentPosition(function(r){var s=r.coords,t=s.latitude,u=s.longitude;d(t,u);setTimeout(function(){o(t,u)},2)},function(){n.showError("Error Finding Location")})}},o=function(v,w){try{var u=e(window),r=u.height(),s=u.width(),q=h(w)-s/2,z=c.imageSize[1]-b(v)-r/2;setTimeout(function(){window.scrollTo(q,z)},10)}catch(t){}},d=function(r,s){try{g.css({display:"block",bottom:b(r),left:h(s)})}catch(q){}},i=function(){g.css({display:"none"})};n.Modules.Map={init:p,show:k,moveTo:o,mark:d,unmark:i}}(KIJ2013,jQuery,navigator));(function(c,f){var b=false,d,e={},g=function(){e=c.getModuleSettings("Radio");d=f("#player").jPlayer({cssSelectorAncestor:"#controls",nativeSupport:true,ready:function(){d.jPlayer("setMedia",{mp3:e.streamURL});b=true},swfPath:"swf",volume:60,errorAlerts:true})},a=function(){c.setTitle("Radio");if(b){d.jPlayer("play")}};c.Modules.Radio={init:g,show:a}}(KIJ2013,jQuery));(function(j,c,m){var f="learn",g="learn-",a,e,n={},i=function(){e=new m({name:f},function(){})},l=function(){b(c(this).data("guid"))},o=function(){j.setActionBarUp();j.setTitle("Learn");j.scrollTop();e.all(function(t){var s=t.length,u;if(s){u=c("<ul/>").attr("id","learn-list").addClass("listview");t.sort(j.Util.sort("date",false));c.each(t,function(w,y){var x,v,z,A;A=y.key;v=c("<li/>").attr("id",g+A);z=y.title||"* New item";x=c("<a/>").text(z);x.data("guid",A);x.click(l);if(A==a){v.addClass("highlight");a=null}v.append(x);u.append(v)});c("#learn").empty().append(u)}})},b=function(s){j.setActionBarUp(o);j.scrollTop();e.get(s,function(u){if(u){var t=c("<div/>").css({padding:"10px"});if(!u.description){j.showLoading();r(s,function(){j.hideLoading();b(s)},function(){j.hideLoading();j.showError("Sorry, Could not find any information on that item.");o()})}else{j.setTitle(u.title);c("<h1/>").text(u.title).appendTo(t);t.append(u.description);c("#learn").empty().append(t)}}})},r=function(u,t,s){c.get(n.contentURL+u,function(v){e.get(u,function(w){w.title=v.title;w.description=v.description;e.save(w)})}).success(t).error(s)},k=function(){n=j.getModuleSettings("Learn");i()},p=function(){o()},h=function(s){if(!e){i()}e.get(s,function(t){if(!t){e.save({key:s,date:(new Date())/1000})}})},d=function(u){var t=c("#"+g+u),s="highlight";if(t.length){t.addClass(s);setTimeout(function(){t.removeClass(s)},3000)}else{a=u}},q=function(){e.nuke()};j.Modules.Learn={init:k,show:p,add:h,highlight:d,clearCache:q}}(KIJ2013,jQuery,Lawnchair));(function(j,c,h){var n=$("#live")[0],b=$("<canvas>")[0],k=b.getContext("2d"),o=null,a=typeof qrcode!=="undefined"?qrcode:false,q,g,p={},m=function(){p=j.getModuleSettings("Barcode");b.width=640;b.height=480;h.getUserMedia||(h.getUserMedia=h.webkitGetUserMedia);c.URL||(c.URL=c.webkitURL||c.msURL||c.oURL);if(!h.getUserMedia){j.showError("Barcode Scanner is not available on your platform.")}},f=function(s){return(c.URL&&c.URL.createObjectURL)?c.URL.createObjectURL(s):s},e=function(){if(o&&a){k.drawImage(n,0,0);a.decode(b.toDataURL("image/webp"))}},d=function(){n.play();if(q){clearInterval(q)}q=setInterval(e,1000)},l=function(){n.pause();clearInterval(q)},r=function(){if(!g){h.getUserMedia({video:true},function(s){n.src=f(s);o=s;g=true;d()},function(s){console.log("Unable to get video stream!")})}},i=function(){l()};if(a){a.callback=function(s){if(s){var u=p.urlPrefix,t=u.length,v=s.slice(t);if(s.slice(0,t)==u){l();j.Modules.Learn.add(v);alert("Congratulations you found an item.");j.navigateTo("Learn");j.Modules.Learn.highlight(v)}else{alert(s)}}}}j.Modules.Barcode={init:m,show:r,start:d,stop:l,hide:i}}(KIJ2013,window,navigator));(function(a,d,e){var c,b=false,f=function(){if(!b){c=d("#subcamp");var h=a.getSetting("subcamps",[]),n=a.getPreference("subcamp"),m=0,g=h.length,j,k;d("<option>").appendTo(c);for(;m<g;m++){j=h[m];k=d("<option>").val(j).text(j).appendTo(c);if(j==n){k.attr("selected",true)}}c.change(function(){var i=c.val();a.setPreference("subcamp",i)});d("#clear-cache").click(function(){a.clearCaches(function(){alert("Cache Cleared")})});d("#clear-preferences").click(function(){a.clearPreferences(function(){c.val("");alert("Preferences Cleared")})});b=true}};a.Modules.Settings={init:f}}(KIJ2013,jQuery,Lawnchair));