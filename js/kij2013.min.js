var KIJ2013=(function(n,i,y){var A="core",o="preferences",q="settings",x="settings.json",h,g,a,l,B={},w=function(F){l=y({name:A},function(){var G=false;this.get(o,function(H){if(H){t=H}if(G&&typeof F=="function"){F()}G=true});this.get(q,function(H){if(H){z=H}C();if(G&&typeof F=="function"){F()}G=true})});v();var D=i("#action_bar select"),E=false;D.empty();for(module in B){if(!E){E=module}D.append("<option>"+KIJ2013.Util.ucfirst(module)+"</option>");if(typeof B[module].init=="function"){B[module].init()}}D.change(function(){u(D.val())});a=i("#popup");h=i("#loading");setTimeout(function(){n.scrollTo(0,1)},0);setTimeout(function(){i("#action_bar").show();u(E)},1500)},C=function(){i.getJSON(z.settingsURL||x,function(D){D.key=q;z=D;l.save(z)})},b=function(){return{key:q,settingsURL:x}},z=b(),j=function(){return{key:o}},t=j(),m=function(D,E){return t[D]||E||null},s=function(D,E){if(D=="key"){return}t[D]=E;l.save(t)},f=function(D){t=j();l.save(t,D)},r=function(D){z=b();l.save(z,D);C();for(module in B){if(B[module].clearCache){B[module].clearCache()}}},u=function(E){var F=i("section:visible"),D;i.each(F,function(G,H){D=KIJ2013.Util.ucfirst(i(H).attr("id"));if(B[D]&&typeof B[D].hide=="function"){B[D].hide()}});F.hide();i("#"+E.toLowerCase()).show();p(E);if(B[E]&&typeof B[E].show=="function"){B[E].show()}c()},v=function(D){if(typeof D=="function"){i("#up-button").removeAttr("href").unbind().click(function(){D();return false});i("#up-icon").css({visibility:"visible"})}else{if(typeof D=="string"){i("#up-button").unbind().click(function(){u(D);return false});i("#up-icon").css("visibility","visible")}else{if(typeof D=="undefined"){i("#up-icon").css("visibility","hidden")}}}},p=function(E){var F=typeof E=="undefined"||E=="",D="KIJ2013";i("title").text(F?D:D+" - "+E);i("#action_bar h1").text(F?D:E)},e=function(){if(h.length==0){h=i("<div/>").attr("id","loading").text("Loading").append(i("<img/>").attr("src","img/ajax-loader.gif")).appendTo("#body")}g=i("section:visible").hide();h.show()},k=function(){if(h){h.hide()}if(g){g.show();g=null}},d=function(D){if(a.length==0){a=i("<div/>").attr("id","popup").appendTo("body")}a.text(D).show();setTimeout(function(){a.slideUp("normal")},5000)},c=function(){n.scrollTo(0,1)};return{clearCaches:r,clearPreferences:f,getPreference:m,hideLoading:k,init:w,navigateTo:u,scrollTop:c,setActionBarUp:v,setPreference:s,setTitle:p,showError:d,showLoading:e,Modules:B}}(window,jQuery,Lawnchair));$(function(){KIJ2013.init()});(function(){var e=function(g,f){if(arguments.length<2){f=255}if(arguments.length<1){g=0}return"rgb("+((f-g)*Math.random()+g).toFixed()+","+((f-g)*Math.random()+g).toFixed()+","+((f-g)*Math.random()+g).toFixed()+")"},c=function(h,g,j,i){var f=function(k){return i?i(k[h]):k[h]};g=arguments.length==2?arguments[1]:arguments[2];j=arguments.length==2?"=":arguments[1];return function(l){var k=f(l);return j=="="?k==g:(j==">"?k>g:(j=="<"?k<g:true))}},b=function(h,f,i){var g=function(j){return i?i(j[h]):j[h]};f=typeof f=="undefined"||f;return function(l,k){var j=g(l),m=g(k);return(j<m?-1:(j>m?+1:0))*[-1,1][+!!f]}},d=function(){var h=[],m,l,f,k,g;for(k=0,l=arguments.length;k<l;k++){m=arguments[k];for(g=0,f=m.length;g<f;g++){if(h.indexOf(m[g])===-1){h.push(m[g])}}}return h},a=function(f){return f.slice(0,1).toUpperCase()+f.slice(1)};KIJ2013.Util={randomColor:e,filter:c,sort:b,merge:d,ucfirst:a}}());(function(n,c,h){var f="feed.php?f=news.rss",m="news",l,e=false,i=null,q=function(){l=new h({name:m},function(){})},o=function(){if(!e){e=true;c.get(f,function(t){var r=[],s,u;c(t).find("item").each(function(w,v){s={key:c(v).find("guid").text(),title:c(v).find("title").text(),date:(new Date(c(v).find("pubDate").text()))/1000,description:c(v).find("content\\:encoded, encoded").text()||c(v).find("description").text()};u=c(s.description).find("img");if(u.length){s.image=c(u[0]).attr("src")}r.push(s)});l.batch(r,function(){if(i=="list"){j()}});e=false},"xml").error(function(t,r,s){n.showError("Error Fetching Items: "+r);e=false})}},b=function(s){var r=c(s.target);a(r.data("guid"))},j=function(){i="list";n.setActionBarUp();n.setTitle("News");n.scrollTop();l.all(function(r){if(r.length){r.sort(n.Util.sort("date",false));var s=c("<ul/>").attr("id","news-list").addClass("listview");c.each(r,function(u,w){var t,v,x;t=c("<li/>");v=c("<a/>").attr("id",w.key);x=c("<span/>").text(w.title);v.append(x);v.data("guid",w.key);v.click(b);if(u==0){t.css({width:"100%"});v.css({height:"140px"})}if(w.image){v.css({backgroundImage:"url("+w.image+")"})}v.css({backgroundColor:n.Util.randomColor(128)});t.append(v);s.append(t)});c("#news").empty().append(s);n.hideLoading()}else{n.showLoading()}})},a=function(r){i="item";n.setActionBarUp(function(){j()});l.get(r,function(t){var s=c("<div/>").css({padding:"10px"});n.setTitle(t.title);c("<h1/>").text(t.title).appendTo(s);s.append(t.description);c("#news").empty().append(s);n.scrollTop()})},p=function(){q();o()},k=function(){j()},d=function(){i=null},g=function(){l.nuke()};n.Modules.News={init:p,show:k,hide:d,clearCache:g}}(KIJ2013,jQuery,Lawnchair));(function(m,e,i){var b="events.json",l="events",k,c=false,q=function(){k=new i({name:l},function(){})},o=function(){e.get(b,function(t){var r=[],s;e(t).each(function(v,u){s={key:u.guid,title:u.title,date:u.date,category:u.category,remind:!!u.remind,description:u.description};k.get(u.guid,function(w){if(w){s.remind=w.remind}});r.push(s)});k.batch(r,function(){if(c){g()}})},"json").error(function(t,r,s){m.showError("Error Fetching Events: "+r)})},d=function(){n(e(this).data("guid"))},a=function(t){var r=t.data.guid,s="active btn-success",u=e(this).toggleClass(s).hasClass(s);k.get(r,function(v){v.remind=u;k.save(v)});return false},g=function(){m.setActionBarUp();m.setTitle("Events");var r=m.getPreference("subcamp");k.all(function(y){var w=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],x,t,z,A,u,v,B,C,s;if(y.length){y=y.filter(m.Util.filter("date",">",(new Date())/1000));if(r){y=m.Util.merge(y.filter(m.Util.filter("category",r)),y.filter(m.Util.filter("category","all")))}y.sort(m.Util.sort("date"));x=e("<ul/>").attr("id","event-list").addClass("listview");e.each(y,function(D,E){z=E.key;A=e("<li/>");t=e("<a/>").attr("id",z);u=new Date(E.date*1000);v=e("<p/>").addClass("date-text").text(u.getDate()+" "+w[u.getMonth()]);B=e("<p/>").addClass("title").text(E.title);C=e("<a/>").addClass("remind-btn btn").addClass(E.remind?"active btn-success":"").text("Remind").click({guid:z},a);s=e("<p/>").addClass("category").text(E.category);t.data("guid",z);t.click(d);t.append(v).append(B).append(C).append(s);A.append(t);x.append(A)});e("#events").empty().append(x);m.hideLoading()}else{m.showLoading()}})},n=function(r){m.setActionBarUp(g);m.scrollTop();k.get(r,function(u){if(u){var t=e("<div/>").css({padding:"10px"}),s=new Date(u.date*1000);m.setTitle(u.title);e("#events").empty();e("<h1/>").text(u.title).appendTo(t);e("<p/>").addClass("date-text").text(s.toLocaleString()).appendTo(t);e("<a/>").addClass("btn").addClass(u.remind?"active btn-success":"").text("Remind").click({guid:r},a).appendTo(t);e("<p/>").attr("id","remind-text").text(u.remind?"You will be reminded about this event.":"You will not be reminded about this event").appendTo(t);e("<p/>").addClass("category").text(u.category).appendTo(t);e("<p/>").text(u.description).appendTo(t);e("#events").append(t)}})},p=function(){q();o()},j=function(){c=true;g()},f=function(){c=false},h=function(){k.nuke()};m.Modules.Events={init:p,show:j,hide:f,clearCache:h}}(KIJ2013,jQuery,Lawnchair));(function(o,f,m){var c=[0.5785846710205073,51.299361979488744,0.5925965309143088,51.305519711648124],h=[2516,1867],n=h[0]/(c[2]-c[0]),a=h[1]/(c[3]-c[1]),g,e,k=false,i=function(q){if(q<c[0]){throw"OutOfBounds"}if(q>c[2]){throw"OutOfBounds"}return(q-c[0])*n},b=function(q){if(q<c[1]){throw"OutOfBounds"}if(q>c[3]){throw"OutOfBounds"}return(q-c[1])*a},l=function(){var q=m.geolocation;if(!k){g=f("#map img");if(g.length==0){o.showLoading();g=f("<img />").attr("src","img/map.png").appendTo("#map").load(function(){p(51.3015,0.584);o.hideLoading()})}e=f("#marker");k=true}else{p(51.3015,0.584)}if(q){q.getCurrentPosition(function(r){var s=r.coords,t=s.latitude,u=s.longitude;d(t,u);setTimeout(function(){p(t,u)},2)},function(){o.showError("Error Finding Location")})}},p=function(v,w){try{var u=f(window),r=u.height(),s=u.width(),q=i(w)-s/2,z=h[1]-b(v)-r/2;setTimeout(function(){window.scrollTo(q,z)},10)}catch(t){}},d=function(r,s){try{e.css({display:"block",bottom:b(r),left:i(s)})}catch(q){}},j=function(){e.css({display:"none"})};o.Modules.Map={show:l,moveTo:p,mark:d,unmark:j}}(KIJ2013,jQuery,navigator));(function(d,f){var c=false,e,b="http://176.227.210.187:8046/;stream=1",g=function(){e=f("#player").jPlayer({cssSelectorAncestor:"#controls",nativeSupport:true,ready:function(){e.jPlayer("setMedia",{mp3:b});c=true},swfPath:"swf",volume:60,errorAlerts:true})},a=function(){d.setTitle("Radio");if(c){e.jPlayer("play")}};d.Modules.Radio={init:g,show:a}}(KIJ2013,jQuery));(function(j,c,m){var f="learn",n="learn.php?id=",g="learn-",a,e,i=function(){e=new m({name:f},function(){})},l=function(){b(c(this).data("guid"))},o=function(){j.setActionBarUp();j.setTitle("Learn");j.scrollTop();e.all(function(t){var s=t.length,u;if(s){u=c("<ul/>").attr("id","learn-list").addClass("listview");t.sort(j.Util.sort("date",false));c.each(t,function(w,y){var x,v,z,A;A=y.key;v=c("<li/>").attr("id",g+A);z=y.title||"* New item";x=c("<a/>").text(z);x.data("guid",A);x.click(l);if(A==a){v.addClass("highlight");a=null}v.append(x);u.append(v)});c("#learn").empty().append(u)}})},b=function(s){j.setActionBarUp(o);j.scrollTop();e.get(s,function(u){if(u){var t=c("<div/>").css({padding:"10px"});if(!u.description){j.showLoading();r(s,function(){j.hideLoading();b(s)},function(){j.hideLoading();j.showError("Sorry, Could not find any information on that item.");o()})}else{j.setTitle(u.title);c("<h1/>").text(u.title).appendTo(t);t.append(u.description);c("#learn").empty().append(t)}}})},r=function(u,t,s){c.get(n+u,function(v){e.get(u,function(w){w.title=v.title;w.description=v.description;e.save(w)})}).success(t).error(s)},k=function(){i()},p=function(){o()},h=function(s){if(!e){i()}e.get(s,function(t){if(!t){e.save({key:s,date:(new Date())/1000})}})},d=function(u){var t=c("#"+g+u),s="highlight";if(t.length){t.addClass(s);setTimeout(function(){t.removeClass(s)},3000)}else{a=u}},q=function(){e.nuke()};j.Modules.Learn={init:k,show:p,add:h,highlight:d,clearCache:q}}(KIJ2013,jQuery,Lawnchair));(function(o,j,a){var e=$("#live")[0],g=$("<canvas>")[0],q=g.getContext("2d"),h=null,m=typeof qrcode!=="undefined"?qrcode:false,f,l,p=function(){g.width=640;g.height=480;a.getUserMedia||(a.getUserMedia=a.webkitGetUserMedia);j.URL||(j.URL=j.webkitURL||j.msURL||j.oURL);if(!a.getUserMedia){o.showError("Barcode Scanner is not available on your platform.")}},c=function(r){return(j.URL&&j.URL.createObjectURL)?j.URL.createObjectURL(r):r},b=function(){if(h&&m){q.drawImage(e,0,0);m.decode(g.toDataURL("image/webp"))}},d=function(){e.play();if(f){clearInterval(f)}f=setInterval(b,1000)},k=function(){e.pause();clearInterval(f)},n=function(){if(!l){a.getUserMedia({video:true},function(r){e.src=c(r);h=r;l=true;d()},function(r){console.log("Unable to get video stream!")})}},i=function(){k()};if(m){m.callback=function(r){if(r){var s=r.slice(26);if(r.slice(0,26)=="http://kij13.org.uk/learn/"){k();o.Modules.Learn.add(s);alert("Congratulations you found an item.");o.navigateTo("Learn");o.Modules.Learn.highlight(s)}else{alert(r)}}}}o.Modules.Barcode={init:p,show:n,start:d,stop:k,hide:i}}(KIJ2013,window,navigator));(function(a,d,e){var c,b=false,f=function(){if(!b){c=d("#subcamp");c.val(a.getPreference("subcamp"));c.change(function(){var g=c.val();a.setPreference("subcamp",g)});d("#clear-cache").click(function(){a.clearCaches(function(){alert("Cache Cleared")})});d("#clear-preferences").click(function(){a.clearPreferences(function(){c.val("");alert("Preferences Cleared")})});b=true}};a.Modules.Settings={init:f}}(KIJ2013,jQuery,Lawnchair));