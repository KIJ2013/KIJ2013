var KIJ2013=(function(f,d,g){var e={key:"preferences"},j="preferences",c,a,b,h,i=["news","events","map","radio","learn","barcode","settings"],k={};k.init=function(n){h=g({name:j},function(){this.get("preferences",function(o){if(o){e=o}if(typeof n=="function"){n()}})});k.setActionBarUp();var m=0,l=d("#action_bar select");l.empty();for(;m<i.length;m++){l.append("<option>"+i[m].slice(0,1).toUpperCase()+i[m].slice(1)+"</option>")}l.change(function(){k.navigateTo(d(this).val())});b=d("#popup");c=d("#loading");k.News.init();setTimeout(function(){f.scrollTo(0,1)},0);setTimeout(function(){d("#splash").hide();d("#action_bar").show();var o=d("#news").show();if(a){a=o}},1500)};k.getPreference=function(l,m){return e[l]||m||null};k.setPreference=function(l,m){if(l=="key"){return}e[l]=m;h.save(e)};k.navigateTo=function(m){var n=d("section:visible"),l;d.each(n,function(o,p){l=d(p).attr("id");l=l.slice(0,1).toUpperCase()+l.slice(1);if(k[l]&&typeof k[l].hide=="function"){k[l].hide()}});n.hide();d("#"+m.toLowerCase()).show();k.setTitle(m);if(k[m]&&typeof k[m].init=="function"){k[m].init()}k.scrollTop()};k.setActionBarUp=function(l){if(typeof l=="function"){d("#up-button").removeAttr("href").unbind().click(function(){l();return false});d("#up-icon").css({visibility:"visible"})}else{if(typeof l=="string"){d("#up-button").unbind().click(function(){k.navigateTo(l);return false});d("#up-icon").css("visibility","visible")}else{if(typeof l=="undefined"){d("#up-icon").css("visibility","hidden")}}}};k.setTitle=function(m){var n=typeof m=="undefined"||m=="",l="KIJ2013";d("title").text(n?l:l+" - "+m);d("#action_bar h1").text(n?l:m)};k.showLoading=function(){if(c.length==0){c=d("<div/>").attr("id","loading").text("Loading").append(d("<img/>").attr("src","img/ajax-loader.gif")).appendTo("#body")}a=d("section:visible").hide();c.show()};k.hideLoading=function(){if(c){c.hide()}if(a){a.show();a=null}};k.showError=function(l){if(b.length==0){b=d("<div/>").attr("id","popup").appendTo("body")}b.text(l).show();setTimeout(function(){b.slideUp("normal")},5000)};k.scrollTop=function(){f.scrollTo(0,1)};return k})(window,jQuery,Lawnchair);$(function(){KIJ2013.init()});KIJ2013.Util=(function(){var a={};a.randomColor=function(c,b){if(arguments.length<2){b=255}if(arguments.length<1){c=0}return"rgb("+((b-c)*Math.random()+c).toFixed()+","+((b-c)*Math.random()+c).toFixed()+","+((b-c)*Math.random()+c).toFixed()+")"};a.filter=function(d,c,f,e){var b=function(g){return e?e(g[d]):g[d]};c=arguments.length==2?arguments[1]:arguments[2];f=arguments.length==2?"=":arguments[1];return function(h){var g=b(h);return f=="="?g==c:(f==">"?g>c:(f=="<"?g<c:true))}};a.sort=function(d,b,e){var c=function(f){return e?e(f[d]):f[d]};b=typeof b=="undefined"||b;return function(h,g){var f=c(h),i=c(g);return(f<i?-1:(f>i?+1:0))*[-1,1][+!!b]}};a.merge=function(){var d=[],g,f,b,e,c;for(e=0,f=arguments.length;e<f;e++){g=arguments[e];for(c=0,b=g.length;c<b;c++){if(d.indexOf(g[c])===-1){d.push(g[c])}}}return d};return a})();KIJ2013.News=(function(k,c,f){var e="feed.php?f=news.rss",j="news",i,d=false,g="list",n=function(){i=new f({name:j},function(){})},l=function(){if(!d){d=true;c.get(e,function(q){var o=[],p,r;c(q).find("item").each(function(t,s){p={key:c(s).find("guid").text(),title:c(s).find("title").text(),date:(new Date(c(s).find("pubDate").text()))/1000,description:c(s).find("content\\:encoded, encoded").text()||c(s).find("description").text()};r=c(p.description).find("img");if(r.length){p.image=c(r[0]).attr("src")}o.push(p)});i.batch(o,function(){if(g=="list"){h()}});d=false},"xml").error(function(q,o,p){k.showError("Error Fetching Items: "+o);d=false})}},b=function(p){g="item";var o=c(p.target);a(o.data("guid"))},h=function(){k.setActionBarUp();k.setTitle("News");k.scrollTop();i.all(function(o){if(o.length){o.sort(k.Util.sort("date",false));var p=c("<ul/>").attr("id","news-list").addClass("listview");c.each(o,function(r,t){var q,s,u;q=c("<li/>");s=c("<a/>").attr("id",t.key);u=c("<span/>").text(t.title);s.append(u);s.data("guid",t.key);s.click(b);if(r==0){q.css({width:"100%"});s.css({height:"140px"})}if(t.image){s.css({backgroundImage:"url("+t.image+")"})}s.css({backgroundColor:k.Util.randomColor(128)});q.append(s);p.append(q)});c("#news").empty().append(p);k.hideLoading()}else{k.showLoading()}})},a=function(o){k.setActionBarUp(function(){g="list";h()});i.get(o,function(q){var p=c("<div/>").css({padding:"10px"});k.setTitle(q.title);c("<h1/>").text(q.title).appendTo(p);p.append(q.description);c("#news").empty().append(p);k.scrollTop()})},m={};m.init=function(){n();l();h()};return m})(KIJ2013,$,Lawnchair);KIJ2013.Events=(function(i,d,f){var b="events.json",h="events",g,m=function(){g=new f({name:h},function(){})},k=function(){d.get(b,function(p){var n=[],o;d(p).each(function(r,q){o={key:q.guid,title:q.title,date:q.date,category:q.category,remind:!!q.remind,description:q.description};g.get(q.guid,function(s){if(s){o.remind=s.remind}});n.push(o)});g.batch(n,function(){e()})},"json").error(function(p,n,o){i.showError("Error Fetching Events: "+n)})},c=function(){j(d(this).data("guid"))},a=function(p){var n=p.data.guid,o="active btn-success",q=d(this).toggleClass(o).hasClass(o);g.get(n,function(r){r.remind=q;g.save(r)});return false},e=function(){i.setActionBarUp();i.setTitle("Events");var n=i.getPreference("subcamp");g.all(function(u){var s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t,p,v,w,q,r,x,y,o;if(u.length){u=u.filter(i.Util.filter("date",">",(new Date())/1000));if(n){u=i.Util.merge(u.filter(i.Util.filter("category",n)),u.filter(i.Util.filter("category","all")))}u.sort(i.Util.sort("date"));t=d("<ul/>").attr("id","event-list").addClass("listview");d.each(u,function(z,A){v=A.key;w=d("<li/>");p=d("<a/>").attr("id",v);q=new Date(A.date*1000);r=d("<p/>").addClass("date-text").text(q.getDate()+" "+s[q.getMonth()]);x=d("<p/>").addClass("title").text(A.title);y=d("<a/>").addClass("remind-btn btn").addClass(A.remind?"active btn-success":"").text("Remind").click({guid:v},a);o=d("<p/>").addClass("category").text(A.category);p.data("guid",v);p.click(c);p.append(r).append(x).append(y).append(o);w.append(p);t.append(w)});d("#events").empty().append(t);i.hideLoading()}else{i.showLoading()}})},j=function(n){i.setActionBarUp(e);i.scrollTop();g.get(n,function(q){if(q){var p=d("<div/>").css({padding:"10px"}),o=new Date(q.date*1000);i.setTitle(q.title);d("#events").empty();d("<h1/>").text(q.title).appendTo(p);d("<p/>").addClass("date-text").text(o.toLocaleString()).appendTo(p);d("<a/>").addClass("btn").addClass(q.remind?"active btn-success":"").text("Remind").click({guid:n},a).appendTo(p);d("<p/>").attr("id","remind-text").text(q.remind?"You will be reminded about this event.":"You will not be reminded about this event").appendTo(p);d("<p/>").addClass("category").text(q.category).appendTo(p);d("<p/>").text(q.description).appendTo(p);d("#events").append(p)}})},l={};l.init=function(){m();e();k()};return l})(KIJ2013,jQuery,Lawnchair);KIJ2013.Map=(function(l,e,j){var c=[0.5785846710205073,51.299361979488744,0.5925965309143088,51.305519711648124],g=[2516,1867],k=g[0]/(c[2]-c[0]),a=g[1]/(c[3]-c[1]),f,d,i=false,h=function(n){if(n<c[0]){throw"OutOfBounds"}if(n>c[2]){throw"OutOfBounds"}return(n-c[0])*k},b=function(n){if(n<c[1]){throw"OutOfBounds"}if(n>c[3]){throw"OutOfBounds"}return(n-c[1])*a},m={};m.init=function(){var n=j.geolocation;if(!i){f=e("#map img");if(f.length==0){l.showLoading();f=e("<img />").attr("src","img/map.png").appendTo("#map").load(function(){l.Map.moveTo(51.3015,0.584);l.hideLoading()})}d=e("#marker");i=true}else{l.Map.moveTo(51.3015,0.584)}if(n){n.getCurrentPosition(function(o){var p=o.coords,q=p.latitude,r=p.longitude;l.Map.mark(q,r);setTimeout(function(){l.Map.moveTo(q,r)},2)},function(){l.showError("Error Finding Location")})}};m.moveTo=function(s,t){try{var r=e(window),o=r.height(),p=r.width(),n=h(t)-p/2,u=g[1]-b(s)-o/2;setTimeout(function(){window.scrollTo(n,u)},10)}catch(q){}};m.mark=function(o,p){try{d.css({display:"block",bottom:b(o),left:h(p)})}catch(n){}};m.unmark=function(){d.css({display:"none"})};return m})(KIJ2013,$,navigator);KIJ2013.Radio=(function(d,f){var c=false,e,b="http://176.227.210.187:8046/;stream=1",a={};a.init=function(){if(!c){e=f("#player").jPlayer({cssSelectorAncestor:"#controls",nativeSupport:true,ready:function(){e.jPlayer("setMedia",{mp3:b}).jPlayer("play")},swfPath:"swf",volume:60,errorAlerts:true});c=true}d.setTitle("Radio")};return a})(KIJ2013,jQuery);KIJ2013.Learn=(function(k,e,h){var j="learn",c="learn.php?id=",l="learn-",d,i,m={},n=function(){i=new h({name:j},function(){})},a=function(){g(e(this).data("guid"))},f=function(){k.setActionBarUp();k.setTitle("Learn");k.scrollTop();i.all(function(p){var o=p.length,q;if(o){q=e("<ul/>").attr("id","learn-list").addClass("listview");p.sort(k.Util.sort("date",false));e.each(p,function(s,u){var t,r,v,w;w=u.key;r=e("<li/>").attr("id",l+w);v=u.title||"* New item";t=e("<a/>").text(v);t.data("guid",w);t.click(a);if(w==d){r.addClass("highlight");d=null}r.append(t);q.append(r)});e("#learn").empty().append(q)}})},g=function(o){k.setActionBarUp(f);k.scrollTop();i.get(o,function(q){if(q){var p=e("<div/>").css({padding:"10px"});if(!q.description){k.showLoading();b(o,function(){k.hideLoading();g(o)},function(){k.hideLoading();k.showError("Sorry, Could not find any information on that item.");f()})}else{k.setTitle(q.title);e("<h1/>").text(q.title).appendTo(p);p.append(q.description);e("#learn").empty().append(p)}}})},b=function(q,p,o){e.get(c+q,function(r){i.get(q,function(s){s.title=r.title;s.description=r.description;i.save(s)})}).success(p).error(o)};m.init=function(){n();f()};m.add=function(o){if(!i){n()}i.get(o,function(p){if(!p){i.save({key:o,date:(new Date())/1000})}})};m.highlight=function(q){var p=e("#"+l+q),o="highlight";if(p.length){p.addClass(o);setTimeout(function(){p.removeClass(o)},3000)}else{d=q}};return m})(KIJ2013,jQuery,Lawnchair);KIJ2013.Barcode=(function(k,h,a){var d=$("#live")[0],f=$("<canvas>")[0],m=f.getContext("2d"),g=null,j=typeof qrcode!=="undefined"?qrcode:false,c=function(){if(g&&j){m.drawImage(d,0,0);j.decode(f.toDataURL("image/webp"))}},b,e,i,l={};f.width=640;f.height=480;a.getUserMedia||(a.getUserMedia=a.webkitGetUserMedia);h.URL||(h.URL=h.webkitURL||h.msURL||h.oURL);b=function(n){return(h.URL&&h.URL.createObjectURL)?h.URL.createObjectURL(n):n};if(j){j.callback=function(n){if(n){var o=n.slice(26);if(n.slice(0,26)=="http://kij13.org.uk/learn/"){k.Barcode.stop();k.Learn.add(o);alert("Congratulations you found an item.");k.navigateTo("Learn");k.Learn.highlight(o)}else{alert(n)}}}}l.init=function(){if(a.getUserMedia){if(!i){a.getUserMedia({video:true},function(n){d.src=b(n);g=n;i=true;k.Barcode.start()},function(n){console.log("Unable to get video stream!")})}else{k.Barcode.start()}}else{k.showError("Barcode Scanner is not available on your platform.")}};l.start=function(){d.play();if(e){clearInterval(e)}e=setInterval(c,1000)};l.stop=function(){d.pause();clearInterval(e)};l.hide=function(){k.Barcode.stop()};return l})(KIJ2013,window,navigator);KIJ2013.Settings=(function(i,b,d){var c="news",a="events",f="learn",h="preferences",g,e=false,j={};j.init=function(){if(!e){g=b("#subcamp");g.val(i.getPreference("subcamp"));g.change(function(){var k=g.val();i.setPreference("subcamp",k)});b("#clear-cache").click(function(){var k=0;d({name:c},function(){this.nuke();if(++k==3){alert("Cache Cleared")}});d({name:a},function(){this.nuke();if(++k==3){alert("Cache Cleared")}});d({name:f},function(){this.nuke();if(++k==3){alert("Cache Cleared")}})});b("#clear-preferences").click(function(){d({name:h},function(){this.nuke();g.val("");alert("Preferences Cleared")})});e=true}};return j})(KIJ2013,jQuery,Lawnchair);