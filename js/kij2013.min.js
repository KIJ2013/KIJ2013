var KIJ2013=(function(k,g,s){var m={key:"preferences"},o="preferences",f,e,a,i,t={},r=function(w){i=s({name:o},function(){this.get("preferences",function(x){if(x){m=x}if(typeof w=="function"){w()}})});q();var u=g("#action_bar select"),v=false;u.empty();for(module in t){if(!v){v=module}u.append("<option>"+KIJ2013.Util.ucfirst(module)+"</option>")}u.change(function(){p(u.val())});a=g("#popup");f=g("#loading");t[v].init();setTimeout(function(){k.scrollTo(0,1)},0);setTimeout(function(){g("#splash").hide();g("#action_bar").show();var x=g("#news").show();if(e){e=x}},1500)},j=function(u,v){return m[u]||v||null},n=function(u,v){if(u=="key"){return}m[u]=v;i.save(m)},p=function(v){var w=g("section:visible"),u;g.each(w,function(x,y){u=KIJ2013.Util.ucfirst(g(y).attr("id"));if(t[u]&&typeof t[u].hide=="function"){t[u].hide()}});w.hide();g("#"+v.toLowerCase()).show();l(v);if(t[v]&&typeof t[v].init=="function"){t[v].init()}b()},q=function(u){if(typeof u=="function"){g("#up-button").removeAttr("href").unbind().click(function(){u();return false});g("#up-icon").css({visibility:"visible"})}else{if(typeof u=="string"){g("#up-button").unbind().click(function(){p(u);return false});g("#up-icon").css("visibility","visible")}else{if(typeof u=="undefined"){g("#up-icon").css("visibility","hidden")}}}},l=function(v){var w=typeof v=="undefined"||v=="",u="KIJ2013";g("title").text(w?u:u+" - "+v);g("#action_bar h1").text(w?u:v)},d=function(){if(f.length==0){f=g("<div/>").attr("id","loading").text("Loading").append(g("<img/>").attr("src","img/ajax-loader.gif")).appendTo("#body")}e=g("section:visible").hide();f.show()},h=function(){if(f){f.hide()}if(e){e.show();e=null}},c=function(u){if(a.length==0){a=g("<div/>").attr("id","popup").appendTo("body")}a.text(u).show();setTimeout(function(){a.slideUp("normal")},5000)},b=function(){k.scrollTo(0,1)};return{getPreference:j,hideLoading:h,init:r,navigateTo:p,scrollTop:b,setActionBarUp:q,setPreference:n,setTitle:l,showError:c,showLoading:d,Modules:t}}(window,jQuery,Lawnchair));$(function(){KIJ2013.init()});KIJ2013.Util=(function(){var e=function(g,f){if(arguments.length<2){f=255}if(arguments.length<1){g=0}return"rgb("+((f-g)*Math.random()+g).toFixed()+","+((f-g)*Math.random()+g).toFixed()+","+((f-g)*Math.random()+g).toFixed()+")"},c=function(h,g,j,i){var f=function(k){return i?i(k[h]):k[h]};g=arguments.length==2?arguments[1]:arguments[2];j=arguments.length==2?"=":arguments[1];return function(l){var k=f(l);return j=="="?k==g:(j==">"?k>g:(j=="<"?k<g:true))}},b=function(h,f,i){var g=function(j){return i?i(j[h]):j[h]};f=typeof f=="undefined"||f;return function(l,k){var j=g(l),m=g(k);return(j<m?-1:(j>m?+1:0))*[-1,1][+!!f]}},d=function(){var h=[],m,l,f,k,g;for(k=0,l=arguments.length;k<l;k++){m=arguments[k];for(g=0,f=m.length;g<f;g++){if(h.indexOf(m[g])===-1){h.push(m[g])}}}return h},a=function(f){return f.slice(0,1).toUpperCase()+f.slice(1)};return{randomColor:e,filter:c,sort:b,merge:d,ucfirst:a}}());(function(k,c,f){var e="feed.php?f=news.rss",j="news",i,d=false,g="list",n=function(){i=new f({name:j},function(){})},l=function(){if(!d){d=true;c.get(e,function(q){var o=[],p,r;c(q).find("item").each(function(t,s){p={key:c(s).find("guid").text(),title:c(s).find("title").text(),date:(new Date(c(s).find("pubDate").text()))/1000,description:c(s).find("content\\:encoded, encoded").text()||c(s).find("description").text()};r=c(p.description).find("img");if(r.length){p.image=c(r[0]).attr("src")}o.push(p)});i.batch(o,function(){if(g=="list"){h()}});d=false},"xml").error(function(q,o,p){k.showError("Error Fetching Items: "+o);d=false})}},b=function(p){g="item";var o=c(p.target);a(o.data("guid"))},h=function(){k.setActionBarUp();k.setTitle("News");k.scrollTop();i.all(function(o){if(o.length){o.sort(k.Util.sort("date",false));var p=c("<ul/>").attr("id","news-list").addClass("listview");c.each(o,function(r,t){var q,s,u;q=c("<li/>");s=c("<a/>").attr("id",t.key);u=c("<span/>").text(t.title);s.append(u);s.data("guid",t.key);s.click(b);if(r==0){q.css({width:"100%"});s.css({height:"140px"})}if(t.image){s.css({backgroundImage:"url("+t.image+")"})}s.css({backgroundColor:k.Util.randomColor(128)});q.append(s);p.append(q)});c("#news").empty().append(p);k.hideLoading()}else{k.showLoading()}})},a=function(o){k.setActionBarUp(function(){g="list";h()});i.get(o,function(q){var p=c("<div/>").css({padding:"10px"});k.setTitle(q.title);c("<h1/>").text(q.title).appendTo(p);p.append(q.description);c("#news").empty().append(p);k.scrollTop()})},m=function(){n();l();h()};k.Modules.News={init:m}}(KIJ2013,jQuery,Lawnchair));(function(i,d,f){var b="events.json",h="events",g,m=function(){g=new f({name:h},function(){})},k=function(){d.get(b,function(p){var n=[],o;d(p).each(function(r,q){o={key:q.guid,title:q.title,date:q.date,category:q.category,remind:!!q.remind,description:q.description};g.get(q.guid,function(s){if(s){o.remind=s.remind}});n.push(o)});g.batch(n,function(){e()})},"json").error(function(p,n,o){i.showError("Error Fetching Events: "+n)})},c=function(){j(d(this).data("guid"))},a=function(p){var n=p.data.guid,o="active btn-success",q=d(this).toggleClass(o).hasClass(o);g.get(n,function(r){r.remind=q;g.save(r)});return false},e=function(){i.setActionBarUp();i.setTitle("Events");var n=i.getPreference("subcamp");g.all(function(u){var s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t,p,v,w,q,r,x,y,o;if(u.length){u=u.filter(i.Util.filter("date",">",(new Date())/1000));if(n){u=i.Util.merge(u.filter(i.Util.filter("category",n)),u.filter(i.Util.filter("category","all")))}u.sort(i.Util.sort("date"));t=d("<ul/>").attr("id","event-list").addClass("listview");d.each(u,function(z,A){v=A.key;w=d("<li/>");p=d("<a/>").attr("id",v);q=new Date(A.date*1000);r=d("<p/>").addClass("date-text").text(q.getDate()+" "+s[q.getMonth()]);x=d("<p/>").addClass("title").text(A.title);y=d("<a/>").addClass("remind-btn btn").addClass(A.remind?"active btn-success":"").text("Remind").click({guid:v},a);o=d("<p/>").addClass("category").text(A.category);p.data("guid",v);p.click(c);p.append(r).append(x).append(y).append(o);w.append(p);t.append(w)});d("#events").empty().append(t);i.hideLoading()}else{i.showLoading()}})},j=function(n){i.setActionBarUp(e);i.scrollTop();g.get(n,function(q){if(q){var p=d("<div/>").css({padding:"10px"}),o=new Date(q.date*1000);i.setTitle(q.title);d("#events").empty();d("<h1/>").text(q.title).appendTo(p);d("<p/>").addClass("date-text").text(o.toLocaleString()).appendTo(p);d("<a/>").addClass("btn").addClass(q.remind?"active btn-success":"").text("Remind").click({guid:n},a).appendTo(p);d("<p/>").attr("id","remind-text").text(q.remind?"You will be reminded about this event.":"You will not be reminded about this event").appendTo(p);d("<p/>").addClass("category").text(q.category).appendTo(p);d("<p/>").text(q.description).appendTo(p);d("#events").append(p)}})},l=function(){m();e();k()};i.Modules.Events={init:l}}(KIJ2013,jQuery,Lawnchair));(function(n,f,l){var c=[0.5785846710205073,51.299361979488744,0.5925965309143088,51.305519711648124],h=[2516,1867],m=h[0]/(c[2]-c[0]),a=h[1]/(c[3]-c[1]),g,e,k=false,i=function(q){if(q<c[0]){throw"OutOfBounds"}if(q>c[2]){throw"OutOfBounds"}return(q-c[0])*m},b=function(q){if(q<c[1]){throw"OutOfBounds"}if(q>c[3]){throw"OutOfBounds"}return(q-c[1])*a},p=function(){var q=l.geolocation;if(!k){g=f("#map img");if(g.length==0){n.showLoading();g=f("<img />").attr("src","img/map.png").appendTo("#map").load(function(){o(51.3015,0.584);n.hideLoading()})}e=f("#marker");k=true}else{o(51.3015,0.584)}if(q){q.getCurrentPosition(function(r){var s=r.coords,t=s.latitude,u=s.longitude;d(t,u);setTimeout(function(){o(t,u)},2)},function(){n.showError("Error Finding Location")})}},o=function(v,w){try{var u=f(window),r=u.height(),s=u.width(),q=i(w)-s/2,z=h[1]-b(v)-r/2;setTimeout(function(){window.scrollTo(q,z)},10)}catch(t){}},d=function(r,s){try{e.css({display:"block",bottom:b(r),left:i(s)})}catch(q){}},j=function(){e.css({display:"none"})};n.Modules.Map={init:p,moveTo:o,mark:d,unmark:j}}(KIJ2013,jQuery,navigator));(function(c,e){var b=false,d,a="http://176.227.210.187:8046/;stream=1",f=function(){if(!b){d=e("#player").jPlayer({cssSelectorAncestor:"#controls",nativeSupport:true,ready:function(){d.jPlayer("setMedia",{mp3:a}).jPlayer("play")},swfPath:"swf",volume:60,errorAlerts:true});b=true}c.setTitle("Radio")};c.Modules.Radio={init:f}}(KIJ2013,jQuery));(function(l,e,h){var k="learn",c="learn.php?id=",m="learn-",i,j,p=function(){j=new h({name:k},function(){})},a=function(){g(e(this).data("guid"))},f=function(){l.setActionBarUp();l.setTitle("Learn");l.scrollTop();j.all(function(r){var q=r.length,s;if(q){s=e("<ul/>").attr("id","learn-list").addClass("listview");r.sort(l.Util.sort("date",false));e.each(r,function(u,w){var v,t,x,y;y=w.key;t=e("<li/>").attr("id",m+y);x=w.title||"* New item";v=e("<a/>").text(x);v.data("guid",y);v.click(a);if(y==i){t.addClass("highlight");i=null}t.append(v);s.append(t)});e("#learn").empty().append(s)}})},g=function(q){l.setActionBarUp(f);l.scrollTop();j.get(q,function(s){if(s){var r=e("<div/>").css({padding:"10px"});if(!s.description){l.showLoading();b(q,function(){l.hideLoading();g(q)},function(){l.hideLoading();l.showError("Sorry, Could not find any information on that item.");f()})}else{l.setTitle(s.title);e("<h1/>").text(s.title).appendTo(r);r.append(s.description);e("#learn").empty().append(r)}}})},b=function(s,r,q){e.get(c+s,function(t){j.get(s,function(u){u.title=t.title;u.description=t.description;j.save(u)})}).success(r).error(q)},o=function(){p();f()},n=function(q){if(!j){p()}j.get(q,function(r){if(!r){j.save({key:q,date:(new Date())/1000})}})},d=function(s){var r=e("#"+m+s),q="highlight";if(r.length){r.addClass(q);setTimeout(function(){r.removeClass(q)},3000)}else{i=s}};l.Modules.Learn={init:o,add:n,highlight:d}}(KIJ2013,jQuery,Lawnchair));(function(n,j,a){var e=$("#live")[0],g=$("<canvas>")[0],p=g.getContext("2d"),h=null,m=typeof qrcode!=="undefined"?qrcode:false,f,l,o=function(){g.width=640;g.height=480;a.getUserMedia||(a.getUserMedia=a.webkitGetUserMedia);j.URL||(j.URL=j.webkitURL||j.msURL||j.oURL);if(a.getUserMedia){if(!l){a.getUserMedia({video:true},function(q){e.src=c(q);h=q;l=true;d()},function(q){console.log("Unable to get video stream!")})}else{d()}}else{n.showError("Barcode Scanner is not available on your platform.")}},c=function(q){return(j.URL&&j.URL.createObjectURL)?j.URL.createObjectURL(q):q},b=function(){if(h&&m){p.drawImage(e,0,0);m.decode(g.toDataURL("image/webp"))}},d=function(){e.play();if(f){clearInterval(f)}f=setInterval(b,1000)},k=function(){e.pause();clearInterval(f)},i=function(){k()};if(m){m.callback=function(q){if(q){var r=q.slice(26);if(q.slice(0,26)=="http://kij13.org.uk/learn/"){k();n.Modules.Learn.add(r);alert("Congratulations you found an item.");n.navigateTo("Learn");n.Modules.Learn.highlight(r)}else{alert(q)}}}}n.Modules.Barcode={init:o,start:d,stop:k,hide:i}}(KIJ2013,window,navigator));(function(i,b,d){var c="news",a="events",f="learn",h="preferences",g,e=false,j=function(){if(!e){g=b("#subcamp");g.val(i.getPreference("subcamp"));g.change(function(){var k=g.val();i.setPreference("subcamp",k)});b("#clear-cache").click(function(){var k=0;d({name:c},function(){this.nuke();if(++k==3){alert("Cache Cleared")}});d({name:a},function(){this.nuke();if(++k==3){alert("Cache Cleared")}});d({name:f},function(){this.nuke();if(++k==3){alert("Cache Cleared")}})});b("#clear-preferences").click(function(){d({name:h},function(){this.nuke();g.val("");alert("Preferences Cleared")})});e=true}};i.Modules.Settings={init:j}}(KIJ2013,jQuery,Lawnchair));