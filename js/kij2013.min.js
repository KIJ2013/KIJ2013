var KIJ2013=function(){var b={},d="preferences",c,a;return{db:null,init:function(e){if(!window.openDatabase){$("#body").html("<p>Sorry Support for your device is not ready yet. Please try again in the future.</p>");return}this.db=window.openDatabase("KIJ2013","1.0","KIJ2013 Database",256*1024);this.sql("CREATE TABLE IF NOT EXISTS `"+d+"` (`key` varchar(255) PRIMARY KEY,`value` varchar(255))");this.sql("SELECT key,value FROM "+d,[],function(f,h){var g,j;for(g=0;g<h.rows.length;g++){j=h.rows.item(g);b[j.key]=j.value}if(typeof e=="function"){e()}});$("#menu a").each(function(){$(this).click(function(){KIJ2013.navigateTo($(this).text())})});KIJ2013.setActionBarUp();$("section").hide();$("#menu").show();a=$("#popup");c=$("#loading")},sql:function(f,e,g){if(typeof g=="function"){this.db.readTransaction(function(h){h.executeSql(f,e,g)})}else{this.db.transaction(function(h){h.executeSql(f,e)})}},getPreference:function(e){return b[e]},setPreference:function(e,f){b[e]=f;this.sql("INSERT OR REPLACE INTO "+d+"(key,value) VALUES (?,?)",[e,f])},navigateTo:function(e){$("section").hide();$("#"+e.toLowerCase()).show();if(KIJ2013[e]&&typeof KIJ2013[e].init=="function"){KIJ2013[e].init()}setTimeout(function(){window.scrollTo(0,1)},1)},setActionBarUp:function(e){if(typeof e=="function"){$("#up-button").removeAttr("href").unbind().click(function(){e();return false});$("#up-icon").css({visibilty:"normal"})}else{if(typeof e=="string"){$("#up-button").unbind().click(function(){KIJ2013.navigateTo(e);return false});$("#up-icon").css("visibility","visible")}else{if(typeof e=="undefined"){$("#up-icon").css("visibility","hidden")}}}},setTitle:function(f){var g=typeof f=="undefined"||f=="",e="KIJ2013";$("title").text(g?e:e+" - "+f);$("#action_bar h1").text(g?e:f)},showLoading:function(){if(c.length==0){c=$("<div/>").attr("id","loading").text("Loading").append($("<img/>").attr("src","img/ajax-loader.gif")).appendTo("body")}c.show()},hideLoading:function(){c.hide()},showError:function(e){if(a.length==0){a=$("<div/>").attr("id","popup").appendTo("body")}a.text(e).show();setTimeout(function(){a.slideUp("normal")},5000)}}}();KIJ2013.Menu=function(){return{init:function(){KIJ2013.setActionBarUp();KIJ2013.setTitle();setTimeout(function(){window.scrollTo(0,1)},1)}}}();KIJ2013.News=function(){var b="news.rss",g="news",f=function(){KIJ2013.db.transaction(function(h){h.executeSql("CREATE TABLE IF NOT EXISTS `"+g+"` (`guid` varchar(255) PRIMARY KEY, `title` varchar(255),`date` int, `description` text)")})},d=function(){$.get(b,function(h){KIJ2013.db.transaction(function(i){$(h).find("item").each(function(l,n){var k=$(n).find("guid").text(),o=$(n).find("title").text(),j=new Date($(n).find("pubDate").text()),m=$(n).find("encoded").text();m=m||$(n).find("description").text();i.executeSql("INSERT INTO `"+g+"` (`guid`, `title`, `date`, `description`) VALUES (?, ?, ?, ?)",[k,o,(j/1000),m])})});c()},"xml").error(function(j,h,i){KIJ2013.showError("Error Fetching Items: "+h)})},e=function(i){var h=$(i.target);a(h.data("guid"))},c=function(){KIJ2013.setActionBarUp("Menu");KIJ2013.setTitle("News");KIJ2013.db.readTransaction(function(h){h.executeSql("SELECT guid,title FROM `"+g+"` ORDER BY `date` DESC LIMIT 30",[],function(m,l){var k=l.rows.length,p,n,q,j,o;if(k){p=$("<ul/>").attr("id","news-list").addClass("listview");for(n=0;n<k;n++){q=l.rows.item(n);j=$("<li/>");o=$("<a/>").attr("id",q.guid).text(q.title);o.data("guid",q.guid);o.click(e);j.append(o);p.append(j)}$("#news").empty().append(p);KIJ2013.hideLoading()}else{KIJ2013.showLoading()}})})},a=function(h){KIJ2013.setActionBarUp(c);KIJ2013.db.readTransaction(function(i){i.executeSql("SELECT title,date,description FROM `"+g+"` WHERE guid = ? LIMIT 1",[h],function(k,j){if(j.rows.length==1){var m=j.rows.item(0),l=$("<div/>").css({padding:"10px"});KIJ2013.setTitle(m.title);$("<h1/>").text(m.title).appendTo(l);l.append(m.description);$("#news").empty().append(l);setTimeout(function(){window.scrollTo(0,1)},1)}})})};return{init:function(){f();c();d()}}}();KIJ2013.Events=function(){var e="events.json",h="events",g=function(){KIJ2013.sql("CREATE TABLE IF NOT EXISTS `"+h+"` (`guid` varchar(255) PRIMARY KEY,`title` varchar(255),`date` int,`category` varchar(255),`remind` bool,`description` text)")},c=function(){$.get(e,function(i){KIJ2013.db.transaction(function(j){$(i).each(function(k,l){j.executeSql("INSERT INTO `"+h+"` (`guid`,`title`,`date`,`category`,`remind`,`description`) VALUES (?, ?, ?, ?, ?, ?)",[l.guid,l.title,l.date,l.category,l.remind?1:0,l.description])})});a()},"json").error(function(k,i,j){KIJ2013.showError("Error Fetching Events: "+i)})},f=function(){b($(this).data("guid"))},d=function(k){var i=k.data.guid,j="selected",l=$(this).toggleClass(j).hasClass(j);KIJ2013.sql("UPDATE "+h+" SET `remind` = ? WHERE `guid` = ?",[l?1:0,i]);return false},a=function(){KIJ2013.setActionBarUp("Menu");KIJ2013.setTitle("Events");var i=KIJ2013.getPreference("subcamp");KIJ2013.sql("SELECT guid,title,date,category,remind FROM `"+h+'` WHERE `date` > ? AND (`category` = ? OR `category` = "all") ORDER BY `date` ASC LIMIT 30',[(new Date())/1000,i],function(n,x){var p=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=x.rows.length,q,m,w,r,s,v,k,l,t,u,j;if(o){q=$("<ul/>").attr("id","event-list").addClass("listview");for(m=0;m<o;m++){w=x.rows.item(m);r=w.guid;s=$("<li/>");v=$("<a/>").attr("id",r);k=new Date(w.date*1000);l=$("<p/>").addClass("date-text").text(k.getDate()+" "+p[k.getMonth()]);t=$("<p/>").addClass("title").text(w.title);u=$("<a/>").addClass("remind-btn button").addClass(w.remind?"selected":"").text("Remind").click({guid:r},d);j=$("<p/>").addClass("category").text(w.category);v.data("guid",w.guid);v.click(f);v.append(l).append(t).append(u).append(j);s.append(v);q.append(s)}$("#events").empty().append(q);KIJ2013.hideLoading()}else{KIJ2013.showLoading()}})},b=function(i){KIJ2013.setActionBarUp(a);var j=KIJ2013.getPreference("subcamp");KIJ2013.sql("SELECT title,date,remind,category,description FROM `"+h+'` WHERE guid = ? AND (`category` = ? OR `category` = "all") LIMIT 1',[i,j],function(l,k){if(k.rows.length==1){var o=k.rows.item(0),n=$("<div/>").css({padding:"10px"}),m=new Date(o.date*1000);KIJ2013.setTitle(o.title);$("#events").empty();$("<h1/>").text(o.title).appendTo(n);$("<p/>").addClass("date-text").text(m.toLocaleString()).appendTo(n);$("<a/>").addClass("button").addClass(o.remind?"selected":"").text("Remind").click({guid:i},d).appendTo(n);$("<p/>").attr("id","remind-text").text(o.remind?"You will be reminded about this event.":"You will not be reminded about this event").appendTo(n);$("<p/>").addClass("category").text(o.category).appendTo(n);$("<p/>").text(o.description).appendTo(n);$("#events").append(n);setTimeout(function(){window.scrollTo(0,1)},1)}})};return{init:function(){g();a();c()}}}();KIJ2013.Map=function(){var c=[0.5785846710205073,51.299361979488744,0.5925965309143088,51.305519711648124],f=[2516,1867],i=f[0]/(c[2]-c[0]),a=f[1]/(c[3]-c[1]),d,e,h=false,g=function(j){if(j<c[0]){throw"OutOfBounds"}if(j>c[2]){throw"OutOfBounds"}return(j-c[0])*i},b=function(j){if(j<c[1]){throw"OutOfBounds"}if(j>c[3]){throw"OutOfBounds"}return(j-c[1])*a};return{init:function(){if(!h){d=$("#map img");if(d.length==0){KIJ2013.showLoading();d=$("<img />").attr("src","img/map.png").appendTo("#map").load(KIJ2013.hideLoading)}e=$("#marker");h=true}KIJ2013.setTitle("Map");KIJ2013.setActionBarUp("Menu");if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(j){var k=j.coords,l=k.latitude,m=k.longitude;KIJ2013.Map.mark(l,m);setTimeout(function(){KIJ2013.Map.moveTo(l,m)},2)},function(){KIJ2013.showError("Error Finding Location")})}},moveTo:function(k,l){try{window.scrollTo(g(l),b(k))}catch(j){}},mark:function(k,l){try{e.css({display:"block",bottom:b(k),left:g(l)})}catch(j){}},unmark:function(){e.css({display:"none"})}}}();KIJ2013.Barcode=function(){var e=$("#live")[0],d=$("<canvas>")[0],a=d.getContext("2d"),c=null,b=function(){if(c){a.drawImage(e,0,0);qrcode.decode(d.toDataURL("image/webp"))}},h=navigator,g=window,f;d.width=640;d.height=480;h.getUserMedia||(h.getUserMedia=h.webkitGetUserMedia);g.URL||(g.URL=g.webkitURL||g.msURL||g.oURL);f=function(i){return(g.URL&&g.URL.createObjectURL)?g.URL.createObjectURL(i):i};qrcode.callback=function(i){if(i){alert(i)}};return{init:function(){KIJ2013.setTitle("Barcode");KIJ2013.setActionBarUp("Menu");h.getUserMedia({video:true},function(i){e.src=f(i);c=i;setInterval(b,1000)},function(i){console.log("Unable to get video stream!")})}}}();KIJ2013.Debug=function(){var c="news",b="events",a=false;return{init:function(){if(!a){$("#subcamp").val(KIJ2013.getPreference("subcamp"));$("#clear-news").click(function(){KIJ2013.db.transaction(function(d){d.executeSql("DELETE FROM "+c);alert("News Items Cleared")})});$("#clear-events").click(function(){KIJ2013.db.transaction(function(d){d.executeSql("DELETE FROM "+b);alert("Events Cleared")})});$("#set-subcamp").click(function(){var d=$("#subcamp").val();KIJ2013.setPreference("subcamp",d);alert("'subcamp' set to '"+d+"'")});a=true}KIJ2013.setTitle("Debug");KIJ2013.setActionBarUp("Menu")}}}();KIJ2013.init();