var KIJ2013=(function(k,g,s){var m={key:"preferences"},o="preferences",f,e,a,i,t={},r=function(w){i=s({name:o},function(){this.get("preferences",function(x){if(x){m=x}if(typeof w=="function"){w()}})});q();var u=g("#action_bar select"),v=false;u.empty();for(module in t){if(!v){v=module}u.append("<option>"+KIJ2013.Util.ucfirst(module)+"</option>");if(typeof t[module].init=="function"){t[module].init()}}u.change(function(){p(u.val())});a=g("#popup");f=g("#loading");setTimeout(function(){k.scrollTo(0,1)},0);setTimeout(function(){g("#action_bar").show();p(v)},1500)},j=function(u,v){return m[u]||v||null},n=function(u,v){if(u=="key"){return}m[u]=v;i.save(m)},p=function(v){var w=g("section:visible"),u;g.each(w,function(x,y){u=KIJ2013.Util.ucfirst(g(y).attr("id"));if(t[u]&&typeof t[u].hide=="function"){t[u].hide()}});w.hide();g("#"+v.toLowerCase()).show();l(v);if(t[v]&&typeof t[v].show=="function"){t[v].show()}b()},q=function(u){if(typeof u=="function"){g("#up-button").removeAttr("href").unbind().click(function(){u();return false});g("#up-icon").css({visibility:"visible"})}else{if(typeof u=="string"){g("#up-button").unbind().click(function(){p(u);return false});g("#up-icon").css("visibility","visible")}else{if(typeof u=="undefined"){g("#up-icon").css("visibility","hidden")}}}},l=function(v){var w=typeof v=="undefined"||v=="",u="KIJ2013";g("title").text(w?u:u+" - "+v);g("#action_bar h1").text(w?u:v)},d=function(){if(f.length==0){f=g("<div/>").attr("id","loading").text("Loading").append(g("<img/>").attr("src","img/ajax-loader.gif")).appendTo("#body")}e=g("section:visible").hide();f.show()},h=function(){if(f){f.hide()}if(e){e.show();e=null}},c=function(u){if(a.length==0){a=g("<div/>").attr("id","popup").appendTo("body")}a.text(u).show();setTimeout(function(){a.slideUp("normal")},5000)},b=function(){k.scrollTo(0,1)};return{getPreference:j,hideLoading:h,init:r,navigateTo:p,scrollTop:b,setActionBarUp:q,setPreference:n,setTitle:l,showError:c,showLoading:d,Modules:t}}(window,jQuery,Lawnchair));$(function(){KIJ2013.init()});(function(){var e=function(g,f){if(arguments.length<2){f=255}if(arguments.length<1){g=0}return"rgb("+((f-g)*Math.random()+g).toFixed()+","+((f-g)*Math.random()+g).toFixed()+","+((f-g)*Math.random()+g).toFixed()+")"},c=function(h,g,j,i){var f=function(k){return i?i(k[h]):k[h]};g=arguments.length==2?arguments[1]:arguments[2];j=arguments.length==2?"=":arguments[1];return function(l){var k=f(l);return j=="="?k==g:(j==">"?k>g:(j=="<"?k<g:true))}},b=function(h,f,i){var g=function(j){return i?i(j[h]):j[h]};f=typeof f=="undefined"||f;return function(l,k){var j=g(l),m=g(k);return(j<m?-1:(j>m?+1:0))*[-1,1][+!!f]}},d=function(){var h=[],m,l,f,k,g;for(k=0,l=arguments.length;k<l;k++){m=arguments[k];for(g=0,f=m.length;g<f;g++){if(h.indexOf(m[g])===-1){h.push(m[g])}}}return h},a=function(f){return f.slice(0,1).toUpperCase()+f.slice(1)};KIJ2013.Util={randomColor:e,filter:c,sort:b,merge:d,ucfirst:a}}());(function(m,c,g){var f="feed.php?f=news.rss",l="news",k,e=false,h=null,p=function(){k=new g({name:l},function(){})},n=function(){if(!e){e=true;c.get(f,function(s){var q=[],r,t;c(s).find("item").each(function(v,u){r={key:c(u).find("guid").text(),title:c(u).find("title").text(),date:(new Date(c(u).find("pubDate").text()))/1000,description:c(u).find("content\\:encoded, encoded").text()||c(u).find("description").text()};t=c(r.description).find("img");if(t.length){r.image=c(t[0]).attr("src")}q.push(r)});k.batch(q,function(){if(h=="list"){i()}});e=false},"xml").error(function(s,q,r){m.showError("Error Fetching Items: "+q);e=false})}},b=function(r){var q=c(r.target);a(q.data("guid"))},i=function(){h="list";m.setActionBarUp();m.setTitle("News");m.scrollTop();k.all(function(q){if(q.length){q.sort(m.Util.sort("date",false));var r=c("<ul/>").attr("id","news-list").addClass("listview");c.each(q,function(t,v){var s,u,w;s=c("<li/>");u=c("<a/>").attr("id",v.key);w=c("<span/>").text(v.title);u.append(w);u.data("guid",v.key);u.click(b);if(t==0){s.css({width:"100%"});u.css({height:"140px"})}if(v.image){u.css({backgroundImage:"url("+v.image+")"})}u.css({backgroundColor:m.Util.randomColor(128)});s.append(u);r.append(s)});c("#news").empty().append(r);m.hideLoading()}else{m.showLoading()}})},a=function(q){h="item";m.setActionBarUp(function(){i()});k.get(q,function(s){var r=c("<div/>").css({padding:"10px"});m.setTitle(s.title);c("<h1/>").text(s.title).appendTo(r);r.append(s.description);c("#news").empty().append(r);m.scrollTop()})},o=function(){p();n()},j=function(){i()},d=function(){h=null};m.Modules.News={init:o,show:j,hide:d}}(KIJ2013,jQuery,Lawnchair));(function(l,e,h){var b="events.json",k="events",j,c=false,p=function(){j=new h({name:k},function(){})},n=function(){e.get(b,function(s){var q=[],r;e(s).each(function(u,t){r={key:t.guid,title:t.title,date:t.date,category:t.category,remind:!!t.remind,description:t.description};j.get(t.guid,function(v){if(v){r.remind=v.remind}});q.push(r)});j.batch(q,function(){if(c){g()}})},"json").error(function(s,q,r){l.showError("Error Fetching Events: "+q)})},d=function(){m(e(this).data("guid"))},a=function(s){var q=s.data.guid,r="active btn-success",t=e(this).toggleClass(r).hasClass(r);j.get(q,function(u){u.remind=t;j.save(u)});return false},g=function(){l.setActionBarUp();l.setTitle("Events");var q=l.getPreference("subcamp");j.all(function(x){var v=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],w,s,y,z,t,u,A,B,r;if(x.length){x=x.filter(l.Util.filter("date",">",(new Date())/1000));if(q){x=l.Util.merge(x.filter(l.Util.filter("category",q)),x.filter(l.Util.filter("category","all")))}x.sort(l.Util.sort("date"));w=e("<ul/>").attr("id","event-list").addClass("listview");e.each(x,function(C,D){y=D.key;z=e("<li/>");s=e("<a/>").attr("id",y);t=new Date(D.date*1000);u=e("<p/>").addClass("date-text").text(t.getDate()+" "+v[t.getMonth()]);A=e("<p/>").addClass("title").text(D.title);B=e("<a/>").addClass("remind-btn btn").addClass(D.remind?"active btn-success":"").text("Remind").click({guid:y},a);r=e("<p/>").addClass("category").text(D.category);s.data("guid",y);s.click(d);s.append(u).append(A).append(B).append(r);z.append(s);w.append(z)});e("#events").empty().append(w);l.hideLoading()}else{l.showLoading()}})},m=function(q){l.setActionBarUp(g);l.scrollTop();j.get(q,function(t){if(t){var s=e("<div/>").css({padding:"10px"}),r=new Date(t.date*1000);l.setTitle(t.title);e("#events").empty();e("<h1/>").text(t.title).appendTo(s);e("<p/>").addClass("date-text").text(r.toLocaleString()).appendTo(s);e("<a/>").addClass("btn").addClass(t.remind?"active btn-success":"").text("Remind").click({guid:q},a).appendTo(s);e("<p/>").attr("id","remind-text").text(t.remind?"You will be reminded about this event.":"You will not be reminded about this event").appendTo(s);e("<p/>").addClass("category").text(t.category).appendTo(s);e("<p/>").text(t.description).appendTo(s);e("#events").append(s)}})},o=function(){p();n()},i=function(){c=true;g()},f=function(){c=false};l.Modules.Events={init:o,show:i,hide:f}}(KIJ2013,jQuery,Lawnchair));(function(o,f,m){var c=[0.5785846710205073,51.299361979488744,0.5925965309143088,51.305519711648124],h=[2516,1867],n=h[0]/(c[2]-c[0]),a=h[1]/(c[3]-c[1]),g,e,k=false,i=function(q){if(q<c[0]){throw"OutOfBounds"}if(q>c[2]){throw"OutOfBounds"}return(q-c[0])*n},b=function(q){if(q<c[1]){throw"OutOfBounds"}if(q>c[3]){throw"OutOfBounds"}return(q-c[1])*a},l=function(){var q=m.geolocation;if(!k){g=f("#map img");if(g.length==0){o.showLoading();g=f("<img />").attr("src","img/map.png").appendTo("#map").load(function(){p(51.3015,0.584);o.hideLoading()})}e=f("#marker");k=true}else{p(51.3015,0.584)}if(q){q.getCurrentPosition(function(r){var s=r.coords,t=s.latitude,u=s.longitude;d(t,u);setTimeout(function(){p(t,u)},2)},function(){o.showError("Error Finding Location")})}},p=function(v,w){try{var u=f(window),r=u.height(),s=u.width(),q=i(w)-s/2,z=h[1]-b(v)-r/2;setTimeout(function(){window.scrollTo(q,z)},10)}catch(t){}},d=function(r,s){try{e.css({display:"block",bottom:b(r),left:i(s)})}catch(q){}},j=function(){e.css({display:"none"})};o.Modules.Map={show:l,moveTo:p,mark:d,unmark:j}}(KIJ2013,jQuery,navigator));(function(d,f){var c=false,e,b="http://176.227.210.187:8046/;stream=1",g=function(){e=f("#player").jPlayer({cssSelectorAncestor:"#controls",nativeSupport:true,ready:function(){e.jPlayer("setMedia",{mp3:b});c=true},swfPath:"swf",volume:60,errorAlerts:true})},a=function(){d.setTitle("Radio");if(c){e.jPlayer("play")}};d.Modules.Radio={init:g,show:a}}(KIJ2013,jQuery));(function(m,e,h){var l="learn",c="learn.php?id=",n="learn-",i,k,q=function(){k=new h({name:l},function(){})},a=function(){g(e(this).data("guid"))},f=function(){m.setActionBarUp();m.setTitle("Learn");m.scrollTop();k.all(function(s){var r=s.length,t;if(r){t=e("<ul/>").attr("id","learn-list").addClass("listview");s.sort(m.Util.sort("date",false));e.each(s,function(v,x){var w,u,y,z;z=x.key;u=e("<li/>").attr("id",n+z);y=x.title||"* New item";w=e("<a/>").text(y);w.data("guid",z);w.click(a);if(z==i){u.addClass("highlight");i=null}u.append(w);t.append(u)});e("#learn").empty().append(t)}})},g=function(r){m.setActionBarUp(f);m.scrollTop();k.get(r,function(t){if(t){var s=e("<div/>").css({padding:"10px"});if(!t.description){m.showLoading();b(r,function(){m.hideLoading();g(r)},function(){m.hideLoading();m.showError("Sorry, Could not find any information on that item.");f()})}else{m.setTitle(t.title);e("<h1/>").text(t.title).appendTo(s);s.append(t.description);e("#learn").empty().append(s)}}})},b=function(t,s,r){e.get(c+t,function(u){k.get(t,function(v){v.title=u.title;v.description=u.description;k.save(v)})}).success(s).error(r)},p=function(){q()},j=function(){f()},o=function(r){if(!k){q()}k.get(r,function(s){if(!s){k.save({key:r,date:(new Date())/1000})}})},d=function(t){var s=e("#"+n+t),r="highlight";if(s.length){s.addClass(r);setTimeout(function(){s.removeClass(r)},3000)}else{i=t}};m.Modules.Learn={init:p,show:j,add:o,highlight:d}}(KIJ2013,jQuery,Lawnchair));(function(o,j,a){var e=$("#live")[0],g=$("<canvas>")[0],q=g.getContext("2d"),h=null,m=typeof qrcode!=="undefined"?qrcode:false,f,l,p=function(){g.width=640;g.height=480;a.getUserMedia||(a.getUserMedia=a.webkitGetUserMedia);j.URL||(j.URL=j.webkitURL||j.msURL||j.oURL);if(!a.getUserMedia){o.showError("Barcode Scanner is not available on your platform.")}},c=function(r){return(j.URL&&j.URL.createObjectURL)?j.URL.createObjectURL(r):r},b=function(){if(h&&m){q.drawImage(e,0,0);m.decode(g.toDataURL("image/webp"))}},d=function(){e.play();if(f){clearInterval(f)}f=setInterval(b,1000)},k=function(){e.pause();clearInterval(f)},n=function(){if(!l){a.getUserMedia({video:true},function(r){e.src=c(r);h=r;l=true;d()},function(r){console.log("Unable to get video stream!")})}},i=function(){k()};if(m){m.callback=function(r){if(r){var s=r.slice(26);if(r.slice(0,26)=="http://kij13.org.uk/learn/"){k();o.Modules.Learn.add(s);alert("Congratulations you found an item.");o.navigateTo("Learn");o.Modules.Learn.highlight(s)}else{alert(r)}}}}o.Modules.Barcode={init:p,show:n,start:d,stop:k,hide:i}}(KIJ2013,window,navigator));(function(i,b,d){var c="news",a="events",f="learn",h="preferences",g,e=false,j=function(){if(!e){g=b("#subcamp");g.val(i.getPreference("subcamp"));g.change(function(){var k=g.val();i.setPreference("subcamp",k)});b("#clear-cache").click(function(){var k=0;d({name:c},function(){this.nuke();if(++k==3){alert("Cache Cleared")}});d({name:a},function(){this.nuke();if(++k==3){alert("Cache Cleared")}});d({name:f},function(){this.nuke();if(++k==3){alert("Cache Cleared")}})});b("#clear-preferences").click(function(){d({name:h},function(){this.nuke();g.val("");alert("Preferences Cleared")})});e=true}};i.Modules.Settings={init:j}}(KIJ2013,jQuery,Lawnchair));