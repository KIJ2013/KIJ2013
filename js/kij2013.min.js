var KIJ2013=(function(o,j,z){var B="core",p="preferences",r="settings",y="settings.json",h,g,a,m,C={},x=function(G){m=z({name:B},function(){var H=false;this.get(p,function(I){if(I){u=I}if(H&&typeof G=="function"){G()}H=true});this.get(r,function(I){if(I){A=I}D();if(H&&typeof G=="function"){G()}H=true})});w();var E=j("#action_bar select"),F=false;E.empty();for(module in C){if(!F){F=module}E.append("<option>"+KIJ2013.Util.ucfirst(module)+"</option>");if(typeof C[module].init=="function"){C[module].init()}}E.change(function(){v(E.val())});a=j("#popup");h=j("#loading");setTimeout(function(){o.scrollTo(0,1)},0);setTimeout(function(){j("#action_bar").show();v(F)},1500)},D=function(){var E=A.settingsURL.push?A.settingsURL.slice():[A.settingsURL];E.push(y);KIJ2013.Util.loadFirst(E,function(F){F.key=r;A=F;m.save(A)})},b=function(){return{key:r,settingsURL:y}},A=b(),k=function(){return{key:p}},u=k(),n=function(E,F){return u[E]||F||null},t=function(E,F){if(E=="key"){return}u[E]=F;m.save(u)},f=function(E){u=k();m.save(u,E)},s=function(E){A=b();m.save(A,E);D();for(module in C){if(C[module].clearCache){C[module].clearCache()}}},v=function(F){var G=j("section:visible"),E;j.each(G,function(H,I){E=KIJ2013.Util.ucfirst(j(I).attr("id"));if(C[E]&&typeof C[E].hide=="function"){C[E].hide()}});G.hide();j("#"+F.toLowerCase()).show();q(F);if(C[F]&&typeof C[F].show=="function"){C[F].show()}c()},w=function(E){if(typeof E=="function"){j("#up-button").removeAttr("href").unbind().click(function(){E();return false});j("#up-icon").css({visibility:"visible"})}else{if(typeof E=="string"){j("#up-button").unbind().click(function(){v(E);return false});j("#up-icon").css("visibility","visible")}else{if(typeof E=="undefined"){j("#up-icon").css("visibility","hidden")}}}},q=function(F){var G=typeof F=="undefined"||F=="",E="KIJ2013";j("title").text(G?E:E+" - "+F);j("#action_bar h1").text(G?E:F)},e=function(){if(h.length==0){h=j("<div/>").attr("id","loading").text("Loading").append(j("<img/>").attr("src","img/ajax-loader.gif")).appendTo("#body")}g=j("section:visible").hide();h.show()},l=function(){if(h){h.hide()}if(g){g.show();g=null}},d=function(E){if(a.length==0){a=j("<div/>").attr("id","popup").appendTo("body")}a.text(E).show();setTimeout(function(){a.slideUp("normal")},5000)},c=function(){o.scrollTo(0,1)};return{clearCaches:s,clearPreferences:f,getPreference:n,hideLoading:l,init:x,navigateTo:v,scrollTop:c,setActionBarUp:w,setPreference:t,setTitle:q,showError:d,showLoading:e,Modules:C}}(window,jQuery,Lawnchair));$(function(){KIJ2013.init()});(function(){var f=function(h,g){if(arguments.length<2){g=255}if(arguments.length<1){h=0}return"rgb("+((g-h)*Math.random()+h).toFixed()+","+((g-h)*Math.random()+h).toFixed()+","+((g-h)*Math.random()+h).toFixed()+")"},c=function(j,h,l,k){var g=function(m){return k?k(m[j]):m[j]};h=arguments.length==2?arguments[1]:arguments[2];l=arguments.length==2?"=":arguments[1];return function(n){var m=g(n);return l=="="?m==h:(l==">"?m>h:(l=="<"?m<h:true))}},b=function(j,g,k){var h=function(l){return k?k(l[j]):l[j]};g=typeof g=="undefined"||g;return function(n,m){var l=h(n),o=h(m);return(l<o?-1:(l>o?+1:0))*[-1,1][+!!g]}},e=function(){var k=[],n,m,g,l,h;for(l=0,m=arguments.length;l<m;l++){n=arguments[l];for(h=0,g=n.length;h<g;h++){if(k.indexOf(n[h])===-1){k.push(n[h])}}}return k},a=function(g){return g.slice(0,1).toUpperCase()+g.slice(1)},d=function(m,n,h){var g=m.length,k=function(){if(i<g){j(i+1)}},j=function(l){$.ajax({url:m[l],dataType:h||"json",success:n,error:k})};j(0)};KIJ2013.Util={randomColor:f,filter:c,sort:b,merge:e,ucfirst:a,loadFirst:d}}());(function(o,c,h){var f="feed.php?f=news.rss",n="news",m,e=false,j=null,r=function(){m=new h({name:n},function(){})},p=function(){if(!e){e=true;c.get(f,function(u){var s=[],t,v;c(u).find("item").each(function(x,w){t={key:c(w).find("guid").text(),title:c(w).find("title").text(),date:(new Date(c(w).find("pubDate").text()))/1000,description:c(w).find("content\\:encoded, encoded").text()||c(w).find("description").text()};v=c(t.description).find("img");if(v.length){t.image=c(v[0]).attr("src")}s.push(t)});m.batch(s,function(){if(j=="list"){k()}});e=false},"xml").error(function(u,s,t){o.showError("Error Fetching Items: "+s);e=false})}},b=function(t){var s=c(t.target);a(s.data("guid"))},k=function(){j="list";o.setActionBarUp();o.setTitle("News");o.scrollTop();m.all(function(s){if(s.length){s.sort(o.Util.sort("date",false));var t=c("<ul/>").attr("id","news-list").addClass("listview");c.each(s,function(v,x){var u,w,y;u=c("<li/>");w=c("<a/>").attr("id",x.key);y=c("<span/>").text(x.title);w.append(y);w.data("guid",x.key);w.click(b);if(v==0){u.css({width:"100%"});w.css({height:"140px"})}if(x.image){w.css({backgroundImage:"url("+x.image+")"})}w.css({backgroundColor:o.Util.randomColor(128)});u.append(w);t.append(u)});c("#news").empty().append(t);o.hideLoading()}else{o.showLoading()}})},a=function(s){j="item";o.setActionBarUp(function(){k()});m.get(s,function(u){var t=c("<div/>").css({padding:"10px"});o.setTitle(u.title);c("<h1/>").text(u.title).appendTo(t);t.append(u.description);c("#news").empty().append(t);o.scrollTop()})},q=function(){r();p()},l=function(){k()},d=function(){j=null},g=function(){m.nuke()};o.Modules.News={init:q,show:l,hide:d,clearCache:g}}(KIJ2013,jQuery,Lawnchair));(function(n,e,j){var b="events.json",m="events",l,c=false,r=function(){l=new j({name:m},function(){})},p=function(){e.get(b,function(u){var s=[],t;e(u).each(function(w,v){t={key:v.guid,title:v.title,date:v.date,category:v.category,remind:!!v.remind,description:v.description};l.get(v.guid,function(x){if(x){t.remind=x.remind}});s.push(t)});l.batch(s,function(){if(c){g()}})},"json").error(function(u,s,t){n.showError("Error Fetching Events: "+s)})},d=function(){o(e(this).data("guid"))},a=function(u){var s=u.data.guid,t="active btn-success",v=e(this).toggleClass(t).hasClass(t);l.get(s,function(w){w.remind=v;l.save(w)});return false},g=function(){n.setActionBarUp();n.setTitle("Events");var s=n.getPreference("subcamp");l.all(function(z){var x=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],y,u,A,B,v,w,C,D,t;if(z.length){z=z.filter(n.Util.filter("date",">",(new Date())/1000));if(s){z=n.Util.merge(z.filter(n.Util.filter("category",s)),z.filter(n.Util.filter("category","all")))}z.sort(n.Util.sort("date"));y=e("<ul/>").attr("id","event-list").addClass("listview");e.each(z,function(E,F){A=F.key;B=e("<li/>");u=e("<a/>").attr("id",A);v=new Date(F.date*1000);w=e("<p/>").addClass("date-text").text(v.getDate()+" "+x[v.getMonth()]);C=e("<p/>").addClass("title").text(F.title);D=e("<a/>").addClass("remind-btn btn").addClass(F.remind?"active btn-success":"").text("Remind").click({guid:A},a);t=e("<p/>").addClass("category").text(F.category);u.data("guid",A);u.click(d);u.append(w).append(C).append(D).append(t);B.append(u);y.append(B)});e("#events").empty().append(y);n.hideLoading()}else{n.showLoading()}})},o=function(s){n.setActionBarUp(g);n.scrollTop();l.get(s,function(v){if(v){var u=e("<div/>").css({padding:"10px"}),t=new Date(v.date*1000);n.setTitle(v.title);e("#events").empty();e("<h1/>").text(v.title).appendTo(u);e("<p/>").addClass("date-text").text(t.toLocaleString()).appendTo(u);e("<a/>").addClass("btn").addClass(v.remind?"active btn-success":"").text("Remind").click({guid:s},a).appendTo(u);e("<p/>").attr("id","remind-text").text(v.remind?"You will be reminded about this event.":"You will not be reminded about this event").appendTo(u);e("<p/>").addClass("category").text(v.category).appendTo(u);e("<p/>").text(v.description).appendTo(u);e("#events").append(u)}})},q=function(){r();p()},k=function(){c=true;g()},f=function(){c=false},h=function(){l.nuke()};n.Modules.Events={init:q,show:k,hide:f,clearCache:h}}(KIJ2013,jQuery,Lawnchair));(function(p,f,n){var c=[0.5785846710205073,51.299361979488744,0.5925965309143088,51.305519711648124],h=[2516,1867],o=h[0]/(c[2]-c[0]),a=h[1]/(c[3]-c[1]),g,e,l=false,j=function(r){if(r<c[0]){throw"OutOfBounds"}if(r>c[2]){throw"OutOfBounds"}return(r-c[0])*o},b=function(r){if(r<c[1]){throw"OutOfBounds"}if(r>c[3]){throw"OutOfBounds"}return(r-c[1])*a},m=function(){var r=n.geolocation;if(!l){g=f("#map img");if(g.length==0){p.showLoading();g=f("<img />").attr("src","img/map.png").appendTo("#map").load(function(){q(51.3015,0.584);p.hideLoading()})}e=f("#marker");l=true}else{q(51.3015,0.584)}if(r){r.getCurrentPosition(function(s){var t=s.coords,u=t.latitude,v=t.longitude;d(u,v);setTimeout(function(){q(u,v)},2)},function(){p.showError("Error Finding Location")})}},q=function(w,z){try{var v=f(window),s=v.height(),t=v.width(),r=j(z)-t/2,A=h[1]-b(w)-s/2;setTimeout(function(){window.scrollTo(r,A)},10)}catch(u){}},d=function(s,t){try{e.css({display:"block",bottom:b(s),left:j(t)})}catch(r){}},k=function(){e.css({display:"none"})};p.Modules.Map={show:m,moveTo:q,mark:d,unmark:k}}(KIJ2013,jQuery,navigator));(function(d,f){var c=false,e,b="http://176.227.210.187:8046/;stream=1",g=function(){e=f("#player").jPlayer({cssSelectorAncestor:"#controls",nativeSupport:true,ready:function(){e.jPlayer("setMedia",{mp3:b});c=true},swfPath:"swf",volume:60,errorAlerts:true})},a=function(){d.setTitle("Radio");if(c){e.jPlayer("play")}};d.Modules.Radio={init:g,show:a}}(KIJ2013,jQuery));(function(k,c,n){var f="learn",o="learn.php?id=",g="learn-",a,e,j=function(){e=new n({name:f},function(){})},m=function(){b(c(this).data("guid"))},p=function(){k.setActionBarUp();k.setTitle("Learn");k.scrollTop();e.all(function(u){var t=u.length,v;if(t){v=c("<ul/>").attr("id","learn-list").addClass("listview");u.sort(k.Util.sort("date",false));c.each(u,function(x,z){var y,w,A,B;B=z.key;w=c("<li/>").attr("id",g+B);A=z.title||"* New item";y=c("<a/>").text(A);y.data("guid",B);y.click(m);if(B==a){w.addClass("highlight");a=null}w.append(y);v.append(w)});c("#learn").empty().append(v)}})},b=function(t){k.setActionBarUp(p);k.scrollTop();e.get(t,function(v){if(v){var u=c("<div/>").css({padding:"10px"});if(!v.description){k.showLoading();s(t,function(){k.hideLoading();b(t)},function(){k.hideLoading();k.showError("Sorry, Could not find any information on that item.");p()})}else{k.setTitle(v.title);c("<h1/>").text(v.title).appendTo(u);u.append(v.description);c("#learn").empty().append(u)}}})},s=function(v,u,t){c.get(o+v,function(w){e.get(v,function(x){x.title=w.title;x.description=w.description;e.save(x)})}).success(u).error(t)},l=function(){j()},q=function(){p()},h=function(t){if(!e){j()}e.get(t,function(u){if(!u){e.save({key:t,date:(new Date())/1000})}})},d=function(v){var u=c("#"+g+v),t="highlight";if(u.length){u.addClass(t);setTimeout(function(){u.removeClass(t)},3000)}else{a=v}},r=function(){e.nuke()};k.Modules.Learn={init:l,show:q,add:h,highlight:d,clearCache:r}}(KIJ2013,jQuery,Lawnchair));(function(p,k,a){var e=$("#live")[0],g=$("<canvas>")[0],r=g.getContext("2d"),h=null,n=typeof qrcode!=="undefined"?qrcode:false,f,m,q=function(){g.width=640;g.height=480;a.getUserMedia||(a.getUserMedia=a.webkitGetUserMedia);k.URL||(k.URL=k.webkitURL||k.msURL||k.oURL);if(!a.getUserMedia){p.showError("Barcode Scanner is not available on your platform.")}},c=function(s){return(k.URL&&k.URL.createObjectURL)?k.URL.createObjectURL(s):s},b=function(){if(h&&n){r.drawImage(e,0,0);n.decode(g.toDataURL("image/webp"))}},d=function(){e.play();if(f){clearInterval(f)}f=setInterval(b,1000)},l=function(){e.pause();clearInterval(f)},o=function(){if(!m){a.getUserMedia({video:true},function(s){e.src=c(s);h=s;m=true;d()},function(s){console.log("Unable to get video stream!")})}},j=function(){l()};if(n){n.callback=function(s){if(s){var t=s.slice(26);if(s.slice(0,26)=="http://kij13.org.uk/learn/"){l();p.Modules.Learn.add(t);alert("Congratulations you found an item.");p.navigateTo("Learn");p.Modules.Learn.highlight(t)}else{alert(s)}}}}p.Modules.Barcode={init:q,show:o,start:d,stop:l,hide:j}}(KIJ2013,window,navigator));(function(a,d,e){var c,b=false,f=function(){if(!b){c=d("#subcamp");c.val(a.getPreference("subcamp"));c.change(function(){var g=c.val();a.setPreference("subcamp",g)});d("#clear-cache").click(function(){a.clearCaches(function(){alert("Cache Cleared")})});d("#clear-preferences").click(function(){a.clearPreferences(function(){c.val("");alert("Preferences Cleared")})});b=true}};a.Modules.Settings={init:f}}(KIJ2013,jQuery,Lawnchair));